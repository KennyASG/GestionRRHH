@model GestionRRHH.Web.Models.Entities.Liquidacione

@{
    ViewData["Title"] = "Detalles de Liquidación";
    var diasDesdeCreacion = (DateTime.Now - (Model.FechaCreacion ?? DateTime.Now)).Days;
    var antiguedadCompleta = $"{Model.AntiguedadAnios} año(s)";
    var salarioMensual = Model.IdEmpleadoNavigation.SalarioBase;
}

@if (TempData["Success"] != null)
{
    <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
        @TempData["Success"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        @TempData["Error"]
    </div>
}

<div class="bg-white rounded-lg shadow">
    <!-- Header -->
    <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex justify-between items-start">
            <div>
                <h3 class="text-lg font-medium text-gray-900">Detalles de Liquidación</h3>
                <p class="text-sm text-gray-500 mt-1">Liquidación #@Model.Id.ToString().PadLeft(6, '0')</p>
            </div>
            <div class="flex space-x-3">
                @if (Model.Estado == "calculada")
                {
                    <form asp-action="Pagar" asp-route-id="@Model.Id" method="post" class="inline" onsubmit="return confirm('¿Marcar como pagada esta liquidación? Esta acción no se puede deshacer.')">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                            <i class="fas fa-money-check-alt mr-2"></i>Marcar como Pagada
                        </button>
                    </form>
                }
                <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                    <i class="fas fa-print mr-2"></i>Imprimir
                </button>
                <a asp-action="Index" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                    <i class="fas fa-arrow-left mr-2"></i>Volver
                </a>
            </div>
        </div>
    </div>

    <div class="p-6">
        <!-- Estado de la Liquidación -->
        <div class="mb-6">
            @if (Model.Estado == "calculada")
            {
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-calculator text-yellow-600 text-2xl mr-3"></i>
                        <div>
                            <h4 class="text-yellow-900 font-medium">Liquidación Calculada</h4>
                            <p class="text-yellow-700 text-sm">Los cálculos han sido realizados según la legislación guatemalteca. Pendiente de pago.</p>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                        <div>
                            <h4 class="text-green-900 font-medium">Liquidación Pagada</h4>
                            <p class="text-green-700 text-sm">Esta liquidación ha sido marcada como pagada y procesada.</p>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Información del Empleado -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h4 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-user mr-2"></i>Información del Empleado
                </h4>
                
                <div class="flex items-center mb-4">
                    <div class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-xl">
                            @(Model.IdEmpleadoNavigation.NombreCompleto.Split(' ').FirstOrDefault()?.Substring(0, 1))@(Model.IdEmpleadoNavigation.NombreCompleto.Split(' ').Skip(1).FirstOrDefault()?.Substring(0, 1))
                        </span>
                    </div>
                    <div class="ml-4">
                        <h5 class="text-lg font-medium text-gray-900">@Model.IdEmpleadoNavigation.NombreCompleto</h5>
                        <p class="text-sm text-gray-600">ID: @Model.IdEmpleadoNavigation.Id.ToString().PadLeft(8, '0')</p>
                        <p class="text-xs text-red-600 font-medium">Estado: INACTIVO</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Departamento:</span>
                        <span class="text-sm text-gray-900">@Model.IdEmpleadoNavigation.Departamento?.Nombre</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Puesto:</span>
                        <span class="text-sm text-gray-900">@Model.IdEmpleadoNavigation.Puesto?.Nombre</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Fecha Contratación:</span>
                        <span class="text-sm text-gray-900">@Model.IdEmpleadoNavigation.FechaContratacion.ToString("dd/MM/yyyy")</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Fecha de Baja:</span>
                        <span class="text-sm text-gray-900">@Model.FechaBaja.ToString("dd/MM/yyyy")</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Antigüedad:</span>
                        <span class="text-sm font-semibold text-gray-900">@antiguedadCompleta</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-gray-600">Último Salario:</span>
                        <span class="text-sm font-semibold text-gray-900">@salarioMensual.ToString("C")</span>
                    </div>
                </div>
            </div>

            <!-- Resumen de la Liquidación -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h4 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-handshake mr-2"></i>Resumen de Liquidación
                </h4>

                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="text-3xl font-bold text-green-600">@Model.TotalLiquidacion.ToString("C")</div>
                        <p class="text-sm text-gray-500">Total de Liquidación</p>
                    </div>

                    <div class="space-y-3">
                        <div class="flex justify-between items-center border-b border-gray-200 pb-2">
                            <span class="text-sm text-gray-600">Vacaciones Pendientes</span>
                            <span class="text-sm font-medium text-blue-600">@((Model.PagoVacaciones ?? 0).ToString("C"))</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-gray-200 pb-2">
                            <span class="text-sm text-gray-600">Indemnización</span>
                            <span class="text-sm font-medium text-red-600">@((Model.Indemnizacion ?? 0).ToString("C"))</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-gray-200 pb-2">
                            <span class="text-sm text-gray-600">Aguinaldo Proporcional</span>
                            <span class="text-sm font-medium text-purple-600">@((Model.AguinaldoProporcional ?? 0).ToString("C"))</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-gray-200 pb-2">
                            <span class="text-sm text-gray-600">Bono 14 Proporcional</span>
                            <span class="text-sm font-medium text-indigo-600">@((Model.Bono14Proporcional ?? 0).ToString("C"))</span>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-green-100 rounded-lg">
                        <p class="text-xs text-green-800">
                            <i class="fas fa-info-circle mr-1"></i>
                            Cálculos realizados según la legislación laboral guatemalteca vigente.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desglose Detallado -->
        <div class="mt-6 bg-white border rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h4 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-calculator mr-2"></i>Desglose Detallado de Cálculos
                </h4>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Vacaciones -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="text-lg font-semibold text-blue-900 mb-3">
                            <i class="fas fa-umbrella-beach mr-2"></i>Vacaciones Pendientes
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Días por año trabajado:</span>
                                <span class="font-medium">15 días</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Años de antigüedad:</span>
                                <span class="font-medium">@Model.AntiguedadAnios año(s)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Total días acumulados:</span>
                                <span class="font-medium">@(Model.AntiguedadAnios * 15) días</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Días pendientes:</span>
                                <span class="font-medium text-blue-700">@(Model.VacacionesPendientes ?? 0) días</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Salario diario:</span>
                                <span class="font-medium">@((salarioMensual / 30).ToString("C"))</span>
                            </div>
                            <hr class="border-blue-200">
                            <div class="flex justify-between text-lg">
                                <span class="font-bold">Subtotal:</span>
                                <span class="font-bold text-blue-700">@((Model.PagoVacaciones ?? 0).ToString("C"))</span>
                            </div>
                        </div>
                        <div class="mt-3 p-2 bg-blue-100 rounded text-xs text-blue-800">
                            <strong>Base Legal:</strong> Art. 130 del Código de Trabajo - 15 días hábiles por año
                        </div>
                    </div>

                    <!-- Indemnización -->
                    <div class="bg-red-50 rounded-lg p-4">
                        <h5 class="text-lg font-semibold text-red-900 mb-3">
                            <i class="fas fa-gavel mr-2"></i>Indemnización
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Salario base mensual:</span>
                                <span class="font-medium">@salarioMensual.ToString("C")</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Años trabajados:</span>
                                <span class="font-medium">@Model.AntiguedadAnios año(s)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Fórmula:</span>
                                <span class="font-medium">1 mes × año</span>
                            </div>
                            <hr class="border-red-200">
                            <div class="flex justify-between text-lg">
                                <span class="font-bold">Subtotal:</span>
                                <span class="font-bold text-red-700">@((Model.Indemnizacion ?? 0).ToString("C"))</span>
                            </div>
                        </div>
                        <div class="mt-3 p-2 bg-red-100 rounded text-xs text-red-800">
                            <strong>Base Legal:</strong> Art. 82 del Código de Trabajo - Indemnización por despido
                        </div>
                    </div>

                    <!-- Aguinaldo -->
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h5 class="text-lg font-semibold text-purple-900 mb-3">
                            <i class="fas fa-gift mr-2"></i>Aguinaldo Proporcional
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Salario base:</span>
                                <span class="font-medium">@salarioMensual.ToString("C")</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Meses trabajados en @Model.FechaBaja.Year:</span>
                                <span class="font-medium">@Model.FechaBaja.Month mes(es)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Proporción:</span>
                                <span class="font-medium">@Model.FechaBaja.Month/12</span>
                            </div>
                            <hr class="border-purple-200">
                            <div class="flex justify-between text-lg">
                                <span class="font-bold">Subtotal:</span>
                                <span class="font-bold text-purple-700">@((Model.AguinaldoProporcional ?? 0).ToString("C"))</span>
                            </div>
                        </div>
                        <div class="mt-3 p-2 bg-purple-100 rounded text-xs text-purple-800">
                            <strong>Base Legal:</strong> Decreto 76-78 - Aguinaldo proporcional
                        </div>
                    </div>

                    <!-- Bono 14 -->
                    <div class="bg-indigo-50 rounded-lg p-4">
                        <h5 class="text-lg font-semibold text-indigo-900 mb-3">
                            <i class="fas fa-award mr-2"></i>Bono 14 Proporcional
                        </h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Salario base:</span>
                                <span class="font-medium">@salarioMensual.ToString("C")</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Meses trabajados en @Model.FechaBaja.Year:</span>
                                <span class="font-medium">@Model.FechaBaja.Month mes(es)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Proporción:</span>
                                <span class="font-medium">@Model.FechaBaja.Month/12</span>
                            </div>
                            <hr class="border-indigo-200">
                            <div class="flex justify-between text-lg">
                                <span class="font-bold">Subtotal:</span>
                                <span class="font-bold text-indigo-700">@((Model.Bono14Proporcional ?? 0).ToString("C"))</span>
                            </div>
                        </div>
                        <div class="mt-3 p-2 bg-indigo-100 rounded text-xs text-indigo-800">
                            <strong>Base Legal:</strong> Decreto 42-92 - Bono 14 proporcional
                        </div>
                    </div>
                </div>

                <!-- Total Final -->
                <div class="mt-6 p-6 bg-green-50 rounded-lg border-2 border-green-200">
                    <div class="text-center">
                        <h3 class="text-2xl font-bold text-green-900 mb-2">TOTAL DE LIQUIDACIÓN</h3>
                        <div class="text-4xl font-bold text-green-700">@Model.TotalLiquidacion.ToString("C")</div>
                        <p class="text-sm text-green-600 mt-2">Calculado según legislación guatemalteca vigente</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Información de Seguimiento -->
        <div class="mt-6 bg-gray-50 rounded-lg p-6">
            <h4 class="text-lg font-medium text-gray-900 mb-4">
                <i class="fas fa-history mr-2"></i>Seguimiento de la Liquidación
            </h4>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <span class="text-sm font-medium text-gray-600">Fecha de Creación</span>
                    <p class="text-sm text-gray-900">@Model.FechaCreacion?.ToString("dd/MM/yyyy HH:mm")</p>
                </div>
                <div>
                    <span class="text-sm font-medium text-gray-600">Última Modificación</span>
                    <p class="text-sm text-gray-900">@Model.FechaModificacion?.ToString("dd/MM/yyyy HH:mm")</p>
                </div>
                <div>
                    <span class="text-sm font-medium text-gray-600">Estado Actual</span>
                    <p class="text-sm font-semibold text-gray-900">@Model.Estado?.ToUpper()</p>
                </div>
            </div>

            @if (Model.Estado == "calculada")
            {
                <div class="mt-4 p-3 bg-yellow-100 rounded-lg">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-clock mr-2"></i>
                        Esta liquidación fue calculada hace @diasDesdeCreacion día(s) y está pendiente de pago.
                    </p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Información para impresión -->
<div class="hidden print:block mt-6 text-center text-sm text-gray-500">
    <p>Liquidación generada el @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</p>
    <p>Sistema de Gestión RRHH - Liquidaciones</p>
    <p>Cálculos realizados según Código de Trabajo de Guatemala (Decreto 1441)</p>
</div>

<style>
@@media print {
    .print\:hidden { display: none !important; }
    .print\:block { display: block !important; }
    body { font-size: 12px; }
    .bg-blue-600, .bg-green-600, .bg-yellow-600, .bg-purple-600, .bg-red-600, .bg-indigo-600 { 
        background-color: #f3f4f6 !important; 
        color: #374151 !important; 
    }
}
</style>